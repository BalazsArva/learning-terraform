parameters:
  - name: host
    type: string
  - name: port
    type: number
  - name: timeout
    type: number
    default: 180
    displayName: Timeout in seconds
  - name: scriptSourceUri
    type: string
    default: https://raw.githubusercontent.com/vishnubob/wait-for-it/master/wait-for-it.sh
  - name: scriptDestinationFolder
    type: string
    default: ~/utils
  - name: scriptDestinationFile
    type: string
    default: wait-for-it.sh

steps:
  - script: |
      mkdir -p $(scriptDestinationFolder)
      ls $(scriptDestinationFolder) | grep $(scriptDestinationFile) || wget scriptSourceUri -O $(scriptDestinationFolder)/$(scriptDestinationFile)
      chmod +rx $(scriptDestinationFolder)/$(scriptDestinationFile)
      bash $(scriptDestinationFolder)/$(scriptDestinationFile) -h $(host) -p $(port) -t $(timeout)
    displayName: Wait for port availability
